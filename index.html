<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tropikalna Przygoda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            touch-action: manipulation; 
            -webkit-tap-highlight-color: transparent; 
            background-color: #064e3b; /* Deep Jungle Green */
        }
        .shake { animation: shake 0.2s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translate(0,0); }
            25% { transform: translate(-10px, 5px); }
            75% { transform: translate(10px, -5px); }
        }
        .active-pad { 
            filter: brightness(1.5) scale(0.95); 
            box-shadow: 0 0 40px #fbbf24; 
        }
        #slingshot-line { pointer-events: none; stroke-dasharray: 8,4; }
        .jungle-font { font-family: 'Arial Black', Gadget, sans-serif; }
    </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen p-4 select-none overflow-hidden">

    <div id="wrapper" class="bg-yellow-900/90 p-6 rounded-[3rem] shadow-2xl border-4 border-yellow-700 max-w-sm w-full text-center relative">
        
        <!-- Pasek Postpu i Nag贸wki -->
        <div id="status" class="hidden mb-4">
            <div class="flex justify-between items-center text-[10px] font-black uppercase tracking-widest text-yellow-200 mb-2">
                <span id="lvl-title">Poziom 1</span>
                <span id="timer" class="text-lg">--</span>
            </div>
            <div class="w-full bg-yellow-950 h-3 rounded-full border border-yellow-800 overflow-hidden">
                <div id="bar" class="h-full bg-green-500 transition-all duration-300 w-0"></div>
            </div>
        </div>

        <!-- Ekrany Gry -->
        
        <!-- 0. WSTP -->
        <div id="screen-intro">
            <div class="mb-6 text-6xl">答ゥ</div>
            <h1 class="text-4xl font-black uppercase italic mb-2 tracking-tighter text-yellow-400 jungle-font">Mapi Interes</h1>
            <p class="text-yellow-100 text-sm mb-8">Pokonaj trzy tropikalne wyzwania, aby zdoby skarb. Tylko dla prawdziwych kr贸l贸w d偶ungli!</p>
            <button onclick="initLvl1()" class="w-full bg-green-600 hover:bg-green-500 text-white font-black py-5 rounded-3xl active:scale-95 transition-all uppercase shadow-lg border-b-8 border-green-800">
                WCHODZ W TO!
            </button>
        </div>

        <!-- 1. POZIOM 1: MAPIA PAMI (Puzzle) -->
        <div id="screen-lvl1" class="hidden">
            <p class="text-sm mb-6 text-yellow-200" id="mem-msg">Patrz uwa偶nie na kokosy...</p>
            <div class="grid grid-cols-2 gap-4 aspect-square">
                <div id="pad-0" onclick="playerTap(0)" class="bg-orange-600 rounded-full h-32 flex items-center justify-center text-4xl border-b-8 border-orange-800">ゥ</div>
                <div id="pad-1" onclick="playerTap(1)" class="bg-amber-600 rounded-full h-32 flex items-center justify-center text-4xl border-b-8 border-amber-800"></div>
                <div id="pad-2" onclick="playerTap(2)" class="bg-lime-600 rounded-full h-32 flex items-center justify-center text-4xl border-b-8 border-lime-800"></div>
                <div id="pad-3" onclick="playerTap(3)" class="bg-emerald-600 rounded-full h-32 flex items-center justify-center text-4xl border-b-8 border-emerald-800">キ</div>
            </div>
        </div>

        <!-- 2. POZIOM 2: KOKOSOWY SNAJPER (Physics) -->
        <div id="screen-lvl2" class="hidden">
            <p class="text-xs mb-4 text-yellow-200">Nacignij lian i traf w uciekajc papug!</p>
            <div id="physics-container" class="relative w-full aspect-square bg-sky-400 rounded-3xl border-4 border-yellow-800 overflow-hidden shadow-inner">
                <div class="absolute bottom-0 w-full h-20 bg-green-700"></div> <!-- Trawnik -->
                <svg id="game-canvas" class="w-full h-full relative z-10">
                    <text id="phys-target" x="80%" y="20%" font-size="40" class="animate-bounce"></text>
                    <text id="projectile" x="50" y="280" font-size="30">ゥ</text>
                    <line id="slingshot-line" x1="50" y1="280" x2="50" y2="280" stroke="#451a03" stroke-width="4" class="hidden" />
                </svg>
                <div id="touch-layer" class="absolute inset-0 z-20 cursor-crosshair"></div>
            </div>
        </div>

        <!-- 3. POZIOM 3: GORCZKA ZOTA (Reflex) -->
        <div id="screen-lvl3" class="hidden">
            <p class="text-xs mb-4 text-yellow-200">Zap 15 zotych monet, zanim soce zajdzie!</p>
            <div id="tap-arena" class="relative w-full aspect-square bg-orange-200 rounded-3xl border-4 border-yellow-800 overflow-hidden shadow-inner">
                <div id="mole" onclick="moleHit()" class="absolute w-16 h-16 rounded-full hidden flex items-center justify-center text-4xl cursor-pointer">
                    
                </div>
            </div>
        </div>

        <!-- EKRAN WYGRANEJ -->
        <div id="screen-win" class="hidden py-8">
            <div class="text-yellow-400 text-6xl mb-4"></div>
            <h2 class="text-3xl font-black text-yellow-400 italic mb-2">KRL D呕UNGLI!</h2>
            <p class="text-yellow-100 text-sm mb-8">Wygrae! Skarb jest Tw贸j. Kliknij poni偶ej, aby go odebra.</p>
            <a href="https://drive.google.com/file/d/1Khm9J8Na9T4lh5QrqpTfPqkvNQveNmTp/view?usp=sharing" class="block w-full bg-green-500 text-white font-black py-5 rounded-3xl animate-pulse text-center shadow-xl border-b-8 border-green-800">
                ODBIERZ SKARB 
            </a>
        </div>

        <!-- EKRAN LITOCI (PO 4 PORA呕KACH) -->
        <div id="screen-pity" class="hidden py-8">
            <div class="text-6xl mb-4"></div>
            <h2 class="text-2xl font-black text-orange-400 italic mb-2 uppercase">SERIO, AMAGAO?</h2>
            <p class="text-yellow-100 text-sm mb-6">Oho, widz 偶e ewolucja u Ciebie stana w miejscu!  Po czwartej nieudanej pr贸bie nawet banany zaczy gni ze wstydu. Dobra, litociwy szympans podaje Ci pomocn do (bo patrze na to nie mo偶e). We藕 sobie ten skarb, ale lito map ma swoje granice!</p>
            <a href="https://drive.google.com/file/d/1Khm9J8Na9T4lh5QrqpTfPqkvNQveNmTp/view?usp=sharing" class="block w-full bg-orange-600 text-white font-black py-4 rounded-2xl text-center border-b-4 border-orange-800">
                DOBRA, DAJ MI TO... Trzymaj
            </a>
        </div>

        <!-- EKRAN PORA呕KI -->
        <div id="screen-fail" class="hidden py-8">
            <div class="text-6xl mb-4"></div>
            <h2 id="fail-title" class="text-3xl font-black text-red-500 italic mb-4">UPS! WPADKA</h2>
            <p id="fail-msg" class="text-yellow-100 text-sm mb-8">Mapy si z Ciebie miej... Spr贸buj jeszcze raz!</p>
            <button onclick="restartLevel()" class="w-full bg-yellow-700 text-white font-black py-4 rounded-2xl border-b-4 border-yellow-900">
                POWTRKA Z ROZRYWKI
            </button>
        </div>

    </div>

    <script>
        /* LOGIKA GLOBALNA */
        let mainTimer;
        let lvl3Fails = 0; // Licznik pora偶ek na 3 poziomie
        let currentLvl = 1;
        
        const show = (id) => {
            document.querySelectorAll('#wrapper > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('wrapper').classList.remove('shake');
            document.getElementById(id).classList.remove('hidden');
            if(id.startsWith('screen-lvl')) document.getElementById('status').classList.remove('hidden');
            else document.getElementById('status').classList.add('hidden');
        };

        const updateBar = (p) => document.getElementById('bar').style.width = p + '%';
        
        const fail = () => {
            clearInterval(mainTimer);
            if (currentLvl === 3) {
                lvl3Fails++;
                if (lvl3Fails >= 4) {
                    show('screen-pity');
                    return;
                }
            }
            show('screen-fail');
        };

        const restartLevel = () => {
            if (currentLvl === 1) initLvl1();
            else if (currentLvl === 2) initLvl2();
            else if (currentLvl === 3) initLvl3();
        };

        /* POZIOM 1: PAMI */
        let sequence = [];
        let playerSeq = [];
        let isShowing = false;

        function initLvl1() {
            currentLvl = 1;
            show('screen-lvl1');
            document.getElementById('lvl-title').innerText = "LVL 1: MAPIA PAMI";
            sequence = Array.from({length: 5}, () => Math.floor(Math.random() * 4));
            playerSeq = [];
            setTimeout(playSequence, 1000);
        }

        async function playSequence() {
            isShowing = true;
            document.getElementById('mem-msg').innerText = "Mapa pokazuje...";
            for (let s of sequence) {
                await new Promise(r => setTimeout(r, 600));
                flash(s);
            }
            isShowing = false;
            document.getElementById('mem-msg').innerText = "Twoja kolej! Powt贸rz!";
        }

        function flash(i) {
            const pad = document.getElementById(`pad-${i}`);
            pad.classList.add('active-pad');
            setTimeout(() => pad.classList.remove('active-pad'), 400);
        }

        function playerTap(i) {
            if (isShowing) return;
            flash(i);
            playerSeq.push(i);
            if (playerSeq[playerSeq.length - 1] !== sequence[playerSeq.length - 1]) return fail();
            updateBar((playerSeq.length / sequence.length) * 100);
            if (playerSeq.length === sequence.length) setTimeout(initLvl2, 800);
        }

        /* POZIOM 2: FIZYKA (KOKOS) */
        let isDragging = false;
        let pPos = { x: 50, y: 280 };
        let startPos = { x: 50, y: 280 };
        let vel = { x: 0, y: 0 };
        let launched = false;

        function initLvl2() {
            currentLvl = 2;
            show('screen-lvl2');
            updateBar(0);
            document.getElementById('lvl-title').innerText = "LVL 2: KOKOSOWY SNAJPER";
            setupSlingshot();
        }

        function setupSlingshot() {
            const touch = document.getElementById('touch-layer');
            const proj = document.getElementById('projectile');
            const line = document.getElementById('slingshot-line');
            const rect = document.getElementById('physics-container').getBoundingClientRect();

            const move = (e) => {
                if (!isDragging || launched) return;
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const dx = (clientX - rect.left) - startPos.x;
                const dy = (clientY - rect.top) - startPos.y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                const limit = 100;
                const scale = dist > limit ? limit/dist : 1;
                pPos.x = startPos.x + dx * scale;
                pPos.y = startPos.y + dy * scale;
                proj.setAttribute('x', pPos.x - 15);
                proj.setAttribute('y', pPos.y + 10);
                line.classList.remove('hidden');
                line.setAttribute('x2', pPos.x);
                line.setAttribute('y2', pPos.y);
                vel.x = (startPos.x - pPos.x) * 0.18;
                vel.y = (startPos.y - pPos.y) * 0.18;
            };

            touch.addEventListener('mousedown', () => isDragging = true);
            touch.addEventListener('touchstart', (e) => { e.preventDefault(); isDragging = true; });
            window.addEventListener('mousemove', move);
            window.addEventListener('touchmove', move);

            const release = () => {
                if (!isDragging || launched) return;
                isDragging = false;
                line.classList.add('hidden');
                launched = true;
                runPhysics();
            };
            window.addEventListener('mouseup', release);
            window.addEventListener('touchend', release);
        }

        function runPhysics() {
            const proj = document.getElementById('projectile');
            let curX = pPos.x;
            let curY = pPos.y;
            const loop = setInterval(() => {
                vel.y += 0.25;
                curX += vel.x;
                curY += vel.y;
                proj.setAttribute('x', curX - 15);
                proj.setAttribute('y', curY + 10);
                const d = Math.sqrt(Math.pow(curX - 256, 2) + Math.pow(curY - 64, 2));
                if (d < 35) {
                    clearInterval(loop);
                    initLvl3();
                }
                if (curX > 400 || curY > 400 || curX < -50) {
                    clearInterval(loop);
                    launched = false;
                    pPos = { x: 50, y: 280 };
                    proj.setAttribute('x', 35);
                    proj.setAttribute('y', 290);
                    document.getElementById('physics-container').classList.add('shake');
                    setTimeout(() => document.getElementById('physics-container').classList.remove('shake'), 200);
                }
            }, 20);
        }

        /* POZIOM 3: REFLEKS */
        let molesHit = 0;
        let gameTime = 18.0;

        function initLvl3() {
            currentLvl = 3;
            gameTime = 18.0; // Reset czasu przy ka偶dym starcie poziomu
            show('screen-lvl3');
            updateBar(0);
            document.getElementById('lvl-title').innerText = "LVL 3: GORCZKA ZOTA";
            molesHit = 0;
            clearInterval(mainTimer);
            mainTimer = setInterval(() => {
                gameTime -= 0.1;
                document.getElementById('timer').innerText = gameTime.toFixed(1) + 's';
                if(gameTime <= 0) fail();
            }, 100);
            spawnMole();
        }

        function spawnMole() {
            const mole = document.getElementById('mole');
            const arena = document.getElementById('tap-arena');
            if (currentLvl !== 3) return;
            mole.classList.remove('hidden');
            mole.style.left = Math.random() * (arena.clientWidth - 70) + 'px';
            mole.style.top = Math.random() * (arena.clientHeight - 70) + 'px';
            
            setTimeout(() => {
                if(!mole.classList.contains('hidden')) {
                    mole.classList.add('hidden');
                    if(molesHit < 15 && currentLvl === 3) spawnMole();
                }
            }, Math.max(350, 900 - (molesHit * 50)));
        }

        function moleHit() {
            molesHit++;
            updateBar((molesHit / 15) * 100);
            document.getElementById('mole').classList.add('hidden');
            if (molesHit >= 15) {
                clearInterval(mainTimer);
                show('screen-win');
            } else {
                spawnMole();
            }
        }
    </script>
</body>
</html>

